name: Sultan Zuma CI

permissions:
  contents: read
  actions: read

on:
  workflow_dispatch:
  push:
    paths-ignore:
      - "README.md"
  pull_request:
    paths-ignore:
      - "README.md"

jobs:
  build:
    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      max-parallel: 3
      matrix:
        build:
          - type: KSUN
            ksu: true
            repo: "KernelSU-Next/KernelSU-Next"
            branch: "next"
            ak3_suffix: "_KSUNext"

          - type: RKSU
            ksu: true
            repo: "rsuntk/KernelSU"
            branch: "susfs-main"
            ak3_suffix: "_RKSU"

          - type: xxKSU
            ksu: true
            repo: "backslashxx/KernelSU"
            branch: "master"
            ak3_suffix: "_xxKSU"

        kernel:
          - codename: "zuma"
            defconfig: "zuma_defconfig"

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # ------------------------------------------------------------
      # Install dependencies
      # ------------------------------------------------------------
      - name: Install build dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            bc bison build-essential ccache flex git \
            libssl-dev libelf-dev libncurses5-dev \
            lz4 wget zip

          ccache --max-size=5G
          ccache --set-config=compression=true
          echo "CCACHE_DIR=$HOME/.ccache" >> $GITHUB_ENV

      # ------------------------------------------------------------
      # Cache toolchain
      # ------------------------------------------------------------
      - name: Cache GCC 14.2.0 toolchain
        id: cache-toolchain
        uses: actions/cache@v4
        with:
          path: toolchain_raw
          key: gcc-14.2.0-aarch64-nolibc

      # ------------------------------------------------------------
      # Download & extract GCC (only if cache miss)
      # ------------------------------------------------------------
      - name: Download an
